
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.7.4">
    
    
      
        <title>Stero Matching - Ye Jiaqi Site</title>
      
    
    
      <script src="../../../assets/javascripts/modernizr-1df76c4e58.js"></script>
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application-769c285a91.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../../assets/css/style.css">
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="../../.." title="Ye Jiaqi Site" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  旧文档
                </span>
              
                <span class="md-header-nav__parent">
                  数图作业
                </span>
              
            
            Stero Matching
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    Ye Jiaqi Site
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="主页" class="md-nav__link">
      主页
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      架构相关
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        架构相关
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      设计模式
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        设计模式
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../architecture/design-pattern/MVC%E8%A7%A3%E8%AF%BB/" title="MVC解读" class="md-nav__link">
      MVC解读
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      算法
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        算法
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../algorithmn/prove-binary-search-is-better/" title="证明二分查找优于三分查找、四分查找" class="md-nav__link">
      证明二分查找优于三分查找、四分查找
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      大前端
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        大前端
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1">
    
    <label class="md-nav__link" for="nav-4-1">
      angular
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        angular
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../front-end/angular/AngularJS%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB%281%29/" title="AngularJS源代码阅读(1) —— angularjs 沉思" class="md-nav__link">
      AngularJS源代码阅读(1) —— angularjs 沉思
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../front-end/angular/AngularJS%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%85%E8%AF%BB%282%29/" title="AngularJS源代码阅读(2) —— 项目结构" class="md-nav__link">
      AngularJS源代码阅读(2) —— 项目结构
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      javasctipt
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        javasctipt
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../front-end/javascript/JS%E5%8E%9F%E5%9E%8B%E9%93%BE%E4%BB%80%E4%B9%88%E9%AC%BC/" title="JS原型链什么鬼" class="md-nav__link">
      JS原型链什么鬼
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../front-end/javascript/JS%E9%97%AD%E5%8C%85%E4%BB%80%E4%B9%88%E9%AC%BC/" title="JS闭包什么鬼" class="md-nav__link">
      JS闭包什么鬼
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../front-end/javascript/JS%E7%9A%84this%E4%BB%80%E4%B9%88%E9%AC%BC/" title="JS的this什么鬼" class="md-nav__link">
      JS的this什么鬼
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../front-end/javascript/JS%E5%B8%B8%E8%A7%81%E5%A4%A7%E5%9D%91/" title="JS常见大坑" class="md-nav__link">
      JS常见大坑
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      范式
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        范式
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../front-end/paradigms/pure-function/" title="函数式编程中的纯函数" class="md-nav__link">
      函数式编程中的纯函数
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-4" type="checkbox" id="nav-4-4">
    
    <label class="md-nav__link" for="nav-4-4">
      调研
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-4">
        调研
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../front-end/survey/ant-design-componets-management/" title="antd生态下的react组件管理" class="md-nav__link">
      antd生态下的react组件管理
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-5" type="checkbox" id="nav-4-5">
    
    <label class="md-nav__link" for="nav-4-5">
      分享会
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-5">
        分享会
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../front-end/share/React%E6%8A%80%E6%9C%AF%E7%94%9F%E6%80%81%E5%92%8C%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93/" title="吴家荣大佬-React技术生态和服务端渲染" class="md-nav__link">
      吴家荣大佬-React技术生态和服务端渲染
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      旧文档
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        旧文档
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-1" type="checkbox" id="nav-5-1" checked>
    
    <label class="md-nav__link" for="nav-5-1">
      数图作业
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-1">
        数图作业
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Quantization-and-Scaling/" title="Quantization and Scaling" class="md-nav__link">
      Quantization and Scaling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Filtering%281%29/" title="Filtering1" class="md-nav__link">
      Filtering1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Filtering%282%29/" title="Filtering2" class="md-nav__link">
      Filtering2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Histogram-Equalization/" title="Histogram Equalization" class="md-nav__link">
      Histogram Equalization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Fourier-Transformation/" title="Fourier Transformation" class="md-nav__link">
      Fourier Transformation
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Stero Matching
      </label>
    
    <a href="./" title="Stero Matching" class="md-nav__link md-nav__link--active">
      Stero Matching
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basic_task" title="Basic Task" class="md-nav__link">
    Basic Task
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation_details" title="implementation details" class="md-nav__link">
    implementation details
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#discussions_of_the_disadvantages_of_the_paper" title="discussions of the disadvantages of the paper" class="md-nav__link">
    discussions of the disadvantages of the paper
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#advantages" title="Advantages:" class="md-nav__link">
    Advantages:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disadvantage" title="Disadvantage:" class="md-nav__link">
    Disadvantage:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conclusion" title="Conclusion:" class="md-nav__link">
    Conclusion:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2">
    
    <label class="md-nav__link" for="nav-5-2">
      以前的项目
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-2">
        以前的项目
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../YOJ/" title="YOJ" class="md-nav__link">
      YOJ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../simple-sinew/" title="Simple Sinew" class="md-nav__link">
      Simple Sinew
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Floater/" title="Floater" class="md-nav__link">
      Floater
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Asentence/" title="Asentence" class="md-nav__link">
      Asentence
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3">
    
    <label class="md-nav__link" for="nav-5-3">
      出过的习题
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-3">
        出过的习题
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../FlowChart-and-PseudoCode/" title="程序流程图和伪代码" class="md-nav__link">
      程序流程图和伪代码
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Memory-Error-Summary-in-c%2B%2B/" title="内存错误总结" class="md-nav__link">
      内存错误总结
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../SimpleList/" title="简单链表" class="md-nav__link">
      简单链表
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-4" type="checkbox" id="nav-5-4">
    
    <label class="md-nav__link" for="nav-5-4">
      面经
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-4">
        面经
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Tencent-interview/" title="腾讯实习面试" class="md-nav__link">
      腾讯实习面试
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Huawei-interview/" title="华为实习面试" class="md-nav__link">
      华为实习面试
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Netease-interview/" title="网易实习面试" class="md-nav__link">
      网易实习面试
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basic_task" title="Basic Task" class="md-nav__link">
    Basic Task
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation_details" title="implementation details" class="md-nav__link">
    implementation details
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#discussions_of_the_disadvantages_of_the_paper" title="discussions of the disadvantages of the paper" class="md-nav__link">
    discussions of the disadvantages of the paper
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#advantages" title="Advantages:" class="md-nav__link">
    Advantages:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disadvantage" title="Disadvantage:" class="md-nav__link">
    Disadvantage:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conclusion" title="Conclusion:" class="md-nav__link">
    Conclusion:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Stero Matching</h1>
                
                <p><img class="img-responsive" src="https://github.com/ghostbody/Image-Processing/blob/master/final/view1.png?raw=true"></p>
<p><img class="img-responsive" src="https://github.com/ghostbody/Image-Processing/blob/master/final/view5.png?raw=true"></p>
<p><img class="img-responsive" src="https://github.com/ghostbody/Image-Processing/blob/master/final/disp1.png?raw=true"></p>
<h2 id="basic_task">Basic Task<a class="headerlink" href="#basic_task" title="Permanent link">&para;</a></h2>
<p><strong>1. Implement a test program to evaluate the quality of your disparity maps. Your program should output the percentage of bad pixels in each of your disparity maps, where bad pixels are those whose errors are greater than one when comparing to ground truths (without multiplication).</strong></p>
<p>(You can see the implementation in the code evaluate.cpp)
Calculation Formula:
(D(x,y) indicates a pixel in disparity map, G(x,y) indicates the corresponding pixel in GroundTruth, when G(x,y) = 0, the result is not defined)</p>
<p>This program is used to evaluate the quality of the disparity map later with inputs(disparitymap, groundtruth) and output(bad_pixel_percentage)
This is an example of its output:</p>
<pre>
[Rocks2]the percentage of bad pixels: 9.355803
[Rocks2]the percentage of bad pixels: 8.801272
[Wood2]the percentage of bad pixels: 18.744331
[Wood2]the percentage of bad pixels: 17.688102
</pre>

<p>The higher bad_pixel_percentage the disparity map has, the worse the disparity map is. So the best way for stero matching should be the way that result in a small bad percentage.</p>
<p><strong>2. Implement a local stereo matching algorithm using “Sum of Squared Difference (SSD)” as matching cost. Compute both the left and the right disparity maps for all test cases, and visualize them by scaling their intensities by a factor of three. Save each disparity map to a file named testcasename disp1 SSD.png or testcasename disp5 SSD.png. Also write down the matching cost function and the quality of your disparity maps.
Matching cost function:</strong></p>
<p>(P,Q indicates the patch in Left and Right)</p>
<p>Experiment in patch size(5*5)
(You can see the result image in the SSD folder)</p>
<p>Evaluating result:
<pre>
[Baby2]          86.623912
[Baby2]          86.485832
[Plastic]        95.403489
[Plastic]        95.960003
[Lampshade1]     90.939392
[Lampshade1]     90.484364
[Wood1]          84.996747
[Wood1]          85.702289
[Cloth2]         85.989014
[Cloth2]         86.743649
[Bowling2]       88.971997
[Bowling2]       89.059850
[Midd1]          90.292357
[Midd1]          91.058413
[Cloth1]         77.970056
[Cloth1]         77.347851
[Aloe]           82.254573
[Aloe]           82.334958
[Monopoly]       91.509975
[Monopoly]       91.359893
[Cloth3]         80.191847
[Cloth3]         79.908614
[Baby1]          79.717950
[Baby1]          79.548459
[Rocks1]         80.377742
[Rocks1]         80.512560
[Lampshade2]     91.407528
[Lampshade2]     91.998627
[Flowerpots]     93.149236
[Flowerpots]     93.285917
[Midd2]          92.732997
[Midd2]          92.919513
[Baby3]          84.986084
[Baby3]          84.874142
[Cloth4]         81.736471
[Cloth4]         82.141564
[Bowling1]       92.239938
[Bowling1]       92.373453
[Rocks2]         82.866137
[Rocks2]         82.267727
[Wood2]          85.840323
[Wood2]          85.942839
</pre></p>
<p><strong>3. Implement a local stereo matching algorithm using “Normalized Cross Correlation (NCC)” as matching cost. Visualize and save your estimated disparity maps to testcasename disp1 NCC.png or testcasename disp5 NCC.png. You are required to figure out the meaning of NCC by yourselves and write down the formula of the NCC matching cost. Also write down the quality of your disparity maps.</strong></p>
<p>NCC explantion:</p>
<blockquote>
<p>In signal processing, cross-correlation is a measure of similarity of two series as a function of the lag of one relative to the other. This is also known as a sliding dot product or sliding inner-product. It is commonly used for searching a long signal for a shorter, known feature. It has applications in pattern recognition, single particle analysis, electron tomography, averaging, cryptanalysis, and neurophysiology.</p>
</blockquote>
<p><em>From wikipedia</em></p>
<p>As an example, consider two real valued functions f and g differing only by an unknown shift along the x-axis. One can use the cross-correlation to find how much g must be shifted along the x-axis to make it identical to f. The formula essentially slides the g function along the x-axis, calculating the integral of their product at each position. When the functions match, the value of (fstar g) is maximized. This is because when peaks (positive areas) are aligned, they make a large contribution to the integral. Similarly, when troughs (negative areas) align, they also make a positive contribution to the integral because the product of two negative numbers is positive.</p>
<p>The Formula of NCC:</p>
<p>(f hat and g hat indicates the mean value of the window, and sigma means the variance of the window)
Notice that we are supposed to use max value according to the definition of NCC, i.e.
Evaluating result:</p>
<pre>
[Baby2]          86.623912
[Baby2]          86.485832
[Plastic]        95.403489
[Plastic]        95.960003
[Lampshade1]     90.939392
[Lampshade1]     90.484364
[Wood1]          84.996747
[Wood1]          85.702289
[Cloth2]         85.989014
[Cloth2]         86.743649
[Bowling2]       88.971997
[Bowling2]       89.059850
[Midd1]          90.292357
[Midd1]          91.058413
[Cloth1]         77.970056
[Cloth1]         77.347851
[Aloe]           82.254573
[Aloe]           82.334958
[Monopoly]       91.509975
[Monopoly]       91.359893
[Cloth3]         80.191847
[Cloth3]         79.908614
[Baby1]          79.717950
[Baby1]          79.548459
[Rocks1]         80.377742
[Rocks1]         80.512560
[Lampshade2]     91.407528
[Lampshade2]     91.998627
[Flowerpots]     93.149236
[Flowerpots]     93.285917
[Midd2]          92.732997
[Midd2]          92.919513
[Baby3]          84.986084
[Baby3]          84.874142
[Cloth4]         81.736471
[Cloth4]         82.141564
[Bowling1]       92.239938
[Bowling1]       92.373453
[Rocks2]         82.866137
[Rocks2]         82.267727
[Wood2]          85.840323
[Wood2]          85.942839
</pre>

<p>Add a small constant amount of intensity (e.g. 10) to all right eye images, and re-run the above two methods. Analyze how the intensity change affects the results (i.e. the quality) of the two methods. Explain in which ways that NCC is a better matching cost than SSD.</p>
<p>In my experiment, if add a small constant of intensity to the image, both NCC and SSD’s disparity map will result in worse result. Specially, the SSD’s disparity map will result even worse than NCC. SSD’s disparity map loss its basic profile but NCC reserved.(see the result in CNCC and CSSD)</p>
<p>SSD add constant 10 result</p>
<pre>
[Baby2]          89.896604
[Baby2]          85.593220
[Plastic]        88.304262
[Plastic]        86.158073
[Lampshade1]     84.219462
[Lampshade1]     73.606516
[Wood1]          88.854456
[Wood1]          91.019575
[Cloth2]         94.607702
[Cloth2]         91.513014
[Bowling2]       84.290159
[Bowling2]       79.769386
[Midd1]          83.192677
[Midd1]          72.415577
[Cloth1]         97.745803
[Cloth1]         95.213559
[Aloe]           93.188176
[Aloe]           94.152794
[Monopoly]       96.091758
[Monopoly]       90.593618
[Cloth3]         94.215438
[Cloth3]         89.472422
[Baby1]          94.743799
[Baby1]          91.389961
[Rocks1]         94.054690
[Rocks1]         90.436248
[Lampshade2]     83.931090
[Lampshade2]     72.315711
[Flowerpots]     73.113365
[Flowerpots]     70.875750
[Midd2]          81.773686
[Midd2]          71.585982
[Baby3]          88.570103
[Baby3]          86.137052
[Cloth4]         95.223769
[Cloth4]         92.755758
[Bowling1]       83.129820
[Bowling1]       76.843606
[Rocks2]         95.115421
[Rocks2]         92.391097
[Wood2]          92.915191
[Wood2]          92.140416
</pre>

<p>NCC add constant 10</p>
<pre>
[Baby2]          87.540082
[Baby2]          20.133499
[Plastic]        71.748131
[Plastic]        25.738930
[Lampshade1]     71.480557
[Lampshade1]     16.047063
[Wood1]          90.974037
[Wood1]          22.077000
[Cloth2]         94.617065
[Cloth2]         20.848262
[Bowling2]       79.796230
[Bowling2]       31.101214
[Midd1]          67.438535
[Midd1]          29.808777
[Cloth1]         85.013935
[Cloth1]         11.200985
[Aloe]           90.169631
[Aloe]           18.427116
[Monopoly]       92.618510
[Monopoly]       37.651150
[Cloth3]         93.256854
[Cloth3]         41.552272
[Baby1]          86.632419
[Baby1]          15.481971
[Rocks1]         93.103975
[Rocks1]         44.372019
[Lampshade2]     65.176955
[Lampshade2]     12.695837
[Flowerpots]     90.497866
[Flowerpots]     47.730843
[Midd2]          66.247104
[Midd2]          30.431838
[Baby3]          88.249119
[Baby3]          33.716989
[Cloth4]         91.010549
[Cloth4]         15.795518
[Bowling1]       61.824486
[Bowling1]       17.068507
[Rocks2]         93.700477
[Rocks2]         37.656598
[Wood2]          67.785648
[Wood2]          11.588071
</pre>

<blockquote>
<p>SSD method has a higher computational complexity compared to SAD algorithm as it involves numerous multiplication operations. Normally, two areas which consist of exactly the same pixel values would yield a score of zero. However, these measures will no longer yield the correct results in the case of radiometric distortion, i.e., where the pixel values in one image differ from those in the other image by a constant offset and/or gain factor.</p>
<p>NCC algorithm is robust to the linear variation in the brightness due to different illumination conditions to the cameras. But it can be seen that due to more complex calculations of division, multiplication and square root its computational time is more than SAD, SSD. Hence it could only be used for real time application only if we are able to develop more efficient algorithm to speed up matching process.</p>
</blockquote>
<p><em>From Papper :Comparison of Various Stereo Vision Cost Aggregation Methods</em></p>
<p>In a word, NCC perform better than SSD when one image differ from those in the other image by a constant offset but cost more time.</p>
<p><strong>5.Cost aggregation using Adaptive Support Weight (ASW) is a powerful local stereo approach. You are required to implement this approach described in the CVPR’05 paper “Locally Adaptive Support-Weight Approach for Visual Correspondence Search” (to save time you are recommended to read mainly sec. 2.6 and sec. 3 of the paper). Visualize and save your estimated disparity maps to testcasename disp1 ASW.png or testcasename disp5 ASW.png. Also write down the quality of your disparity maps. Note that this algorithm is in general a bit slow.</strong></p>
<pre>
[Baby2]          20.133499
[Plastic]        25.738930
[Lampshade1]     16.047063
[Wood1]          22.077000
[Cloth2]         20.848262
[Bowling2]       31.101214
[Midd1]          29.808777
[Cloth1]         11.200985
[Aloe]           18.427116
[Monopoly]       37.651150
[Cloth3]         41.552272
[Baby1]          15.481971
[Rocks1]         44.372019
[Lampshade2]     12.695837
[Flowerpots]     47.730843
[Midd2]          30.431838
[Baby3]          33.716989
[Cloth4]         15.795518
[Bowling1]       17.068507
[Rocks2]         37.656598
[Wood2]          11.588071
</pre>

<p><strong>6.6. Explain the idea of the ASW paper in question 5. Also explain in which ways ASW is better than NCC. Why?</strong></p>
<p>The core idea of ASW(Adaptive Support-Weight Approach) is to give a weight value to each pixel in the matching window, which is based on the color difference and the distance between them and the center point of the window. In essence, an approximate image segmentation is completed.</p>
<p>According to the like between location and color difference of window in the original pixel cost Fu to different weighting, and to perform polymerization. Many studies show that the algorithm is all local stereo matching effect is the best, and the result of matching algorithm and the optimization results compared. But the algorithm of adaptive weighted algorithm is relatively slow, and the complexity of the algorithm is relatively high, and the weight of the storage space is very large.</p>
<p>ASW is better than NCC, but NCC is very slow. In the case that the images are colorful(3 channels), ASW is good. But for gray images, ASW are not necessary because color images do not have the definition of color difference(cq).</p>
<h2 id="implementation_details">implementation details<a class="headerlink" href="#implementation_details" title="Permanent link">&para;</a></h2>
<p>Code sturcture:
<pre>
bat.py #the program to process all the images
stero0.cpp #the program to process SSD and NCC
stero1.cpp #the program to process CNCC and CSSD
stero2.cpp #the program to process ASW
</pre></p>
<p>For basic SSD and NCC and also ASW, the main algorithm is as follow:</p>
<ol>
<li>Read the image into memory</li>
<li>Traversal the image, process each point and calculate d for the destination image.
  2.1. for each of the point, calculate a patch from the left(right) image and then travel from 0 - dmax and calculate another patch from the right(left) image.
  2.2 use the setting patch to calculate match cost and then choose the best match cost to be arg d.</li>
<li>Save the image</li>
</ol>
<p>For SSD:
The matching cost image is calculate by the following fomula:</p>
<span>\[
C(x,y)= \sum_{i,j \in N}(N_p(i,j)-N_q(i,j))^2
\]</span><p>i.e. sum the absolute square value of the corresponding patches.</p>
<div class="codehilite"><pre><span></span>  for(int i = 0; i &lt; P.rows; i++) {
    for(int j = 0; j &lt; P.cols; j++) {
      int difference = P.at&lt;int&gt;(i,j) - Q.at&lt;int&gt;(i,j);
      sum += difference * difference;
    }
  }
</pre></div>

<p>For NCC:</p>
<span>\[
  D(p,q) = \frac{1}{n} \cdot \sum_{i,j \in N_{pq}} \frac{(f_p(i,j) - \hat f_p) \cdot (g_q(i,j) - \hat g_q)}{ \sigma f_p \sigma g_p}
\]</span><p>For ASW:(it will be more diffcult)
In the paper, we can conclude the several formulas:
Matching Value:</p>
<span>\[
d_p = arg_{d \in } \{d_{min}...d_{max}\}
\]</span><p>Matching Cost:</p>
<span>\[
E(p,pd) = \frac{\sum_{q \in W}w(p,q)w(p_d,q_d)e_0(q,qd)}{\sum_{q \in W}w(p,q)w(p_d,q_d)}
\]</span><div class="codehilite"><pre><span></span>    double Eppd(const Mat &amp; P, const Mat &amp; Q, int d) {
      Vec3b p = P.at&lt;Vec3b&gt;(P.rows / 2, P.cols / 2);
      Vec3b pd = Q.at&lt;Vec3b&gt;(Q.rows / 2, Q.cols / 2);
      double sum1 = 0;
      double sum2 = 0;
      for(int i = 0; i &lt; P.rows; i++) {
        for(int j = 0; j &lt; P.cols; j++) {
          sum1 += wpq(p, P.at&lt;Vec3b&gt;(i,j), d) * wpq(pd, Q.at&lt;Vec3b&gt;(i,j), d) * e0(P.at&lt;Vec3b&gt;(i,j), Q.at&lt;Vec3b&gt;(i,j));
          sum2 += wpq(p, P.at&lt;Vec3b&gt;(i,j), d) * wpq(pd, Q.at&lt;Vec3b&gt;(i,j), d);
        }
      }
      return sum2 != 0 ? sum1 / sum2 : 0;
    }
</pre></div>

<p>Adptive Weight:</p>
<span>\[
w(p,q) = k \cdot exp(-(\frac{\Delta c_{pq}}{\gamma c} + \frac{\Delta gpq}{\gamma p}))
\]</span><div class="codehilite"><pre><span></span>    double wpq(const Vec3b &amp; p, const Vec3b &amp; q, int d) {
      double k = 100;
      double gamac = 40;
      double gamap = 7;
      return k*exp(-(deltaCpq(p,q) / gamac + d / gamap));
    }
</pre></div>

<p>Error modification:</p>
<div class="codehilite"><pre><span></span>    double e0(const Vec3b &amp; q, const Vec3b &amp; qd) {
      return abs(q[0] - qd[0]) + abs(q[1] - qd[1]) + abs(q[2] - qd[2]);
    }
</pre></div>

<p>Color difference:
RGB calculation:</p>
<span>\[
C_{pq} = \sqrt{\omega_r(p_R-q_R)^2+\omega_g(p_G-q_G)^2+\omega_b(p_B-q_B)^2}
\]</span><p>often with(<span>\(<span>\((\omega_r,\omega_g,\omega_b)=(3,4,2)\)</span>\)</span>)</p>
<p>Lab calculation:</p>
<span>\[
C_{pq} = \sqrt{(L_1^*-L_2^*)^2+(a_1-a2)^2+(c_1-c_2)^2}
\]</span><div class="codehilite"><pre><span></span>  // Lab space color difference calculation
  double deltaCpq(const Vec3b &amp; p, const Vec3b &amp; q) {
    double pXYZ[3] = {0};
    double qXYZ[3] = {0};
    double pLab[3] = {0};
    double qLab[3] = {0};

    pXYZ[0] = p[0] * 0.4124 + p[1] * 0.3576 + p[2] * 0.1805;
    pXYZ[1] = p[0] * 0.2126 + p[1] * 0.7152 + p[2] * 0.0722;
    pXYZ[2] = p[0] * 0.0193 + p[1] * 0.1192 + p[2] * 0.9505;

    qXYZ[0] = q[0] * 0.4124 + q[1] * 0.3576 + q[2] * 0.1805;
    qXYZ[1] = q[0] * 0.2126 + q[1] * 0.7152 + q[2] * 0.0722;
    qXYZ[2] = q[0] * 0.0193 + q[1] * 0.1192 + q[2] * 0.9505;

    const double Xn = 95.047;
    const double Yn = 100.0;
    const double Zn = 108.883;

    qLab[0] = 116 * f(qXYZ[1] / Yn) - 16;
    qLab[1] = 500 * (f(qXYZ[0]) / Xn - (f(qXYZ[1]) / Yn));
    qLab[2] = 200 * (f(qXYZ[1]) / Yn - (f(qXYZ[2]) / Zn));

    return sqrt((pLab[0] - qLab[0]) * (pLab[0] - qLab[0]) + (pLab[1] - qLab[1]) * (pLab[1] - qLab[1]) + (pLab[2] - qLab[2]) * (pLab[2] - qLab[2]));
  }

  //RGB space color difference calculation
   double deltaCpq(const Vec3b &amp; p, const Vec3b &amp; q) {
     const int wr = 3;
     const int wg = 4;
     const int wb = 2;
     return sqrt(wr*(p[0] - q[0]) * (p[0] - q[0]) + wg*(p[1] - q[1]) * (p[1] - q[1]) + wb*(p[2] - q[2]) * (p[2] - q[2]));
   }
</pre></div>

<h2 id="discussions_of_the_disadvantages_of_the_paper">discussions of the disadvantages of the paper<a class="headerlink" href="#discussions_of_the_disadvantages_of_the_paper" title="Permanent link">&para;</a></h2>
<h3 id="advantages">Advantages:<a class="headerlink" href="#advantages" title="Permanent link">&para;</a></h3>
<p>The matching method can make a better result than both SSD and NCC. It can use a detail method to define the matching cost in a good way. Using the definition of color difference and the “adptive weight” is truly a good approach.</p>
<p>It’s a landmark works in local stereo matching algorithm(maybe but i think it’s not good, maybe it’s my problem). From CVPR and PAMI you can see its component.</p>
<p>AdaptiveWeight method has been proposed, formally declared in the matching accuracy, the adaptive Adaptive out algorithm (Window)(This method is unscientific at all i think). And later became popular.</p>
<h3 id="disadvantage">Disadvantage:<a class="headerlink" href="#disadvantage" title="Permanent link">&para;</a></h3>
<p>Too many formulas :&lt;. They are supposed to give an example program but didn’t. :&lt;
The algorithm is so slow that i can not stand it, and my computer can not afford a argument of window size of 33. :&lt;</p>
<p>Locally approach can not do as well as global one. But there is so many projects for me to finish, i do not have time to do it. :&lt;</p>
<h3 id="conclusion">Conclusion:<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h3>
<p>This project is in fact very boring and seems that it’s irrelevant to what we have learnt. I have many unsolved questions:</p>
<ol>
<li>Why my program is so slow(not a bit slow)? How can I improve it?
I used python as program language for the last 4 homework project. But this time i use c++ for programming, I think it should be quicker because c++ is a basic high level language and is known to be 10 times faster than python. But thep processing speed is stiil very slow.</li>
<li>Why my picture is so ugly compare to the ground truth?
Many of my fellows also have this problem that the output image is very ugly compare to the groud truth, especially for the edge of the image. We check it for several times and discuss it for a better way but failed. We try to ask TA for help, but no responds :&lt;. We also ask professor Chao for help but she tells us to ask TA for help.</li>
<li>How to calculate the error pixels since the error rate in the paper is less than 5% when window size is set to 5, but my error rate is greater than 70% for average?
We should calculate absolute error in the paper that error &lt; 1. But, the error rate is so high. I also ignore a border of 10 in the image but also very high.
In a word, we have still some problems. My be we can do better with more time. :&lt;</li>
</ol>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Fourier-Transformation/" title="Fourier Transformation" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Fourier Transformation
              </span>
            </div>
          </a>
        
        
          <a href="../YOJ/" title="YOJ" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                YOJ
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/ghostbody" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application-c35428f87f.js"></script>
      
      
      <script>app.initialize({url:{base:"../../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
    
      
    
  </body>
</html>